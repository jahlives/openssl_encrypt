{
  "app-id": "com.opensslencrypt.OpenSSLEncrypt",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "24.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "openssl-encrypt",
  "finish-args": [
    "--share=ipc",
    "--socket=x11",
    "--socket=fallback-x11",
    "--socket=wayland",
    "--filesystem=host",
    "--filesystem=host-os",
    "--filesystem=/tmp",
    "--filesystem=/var/tmp",
    "--filesystem=/run/media",
    "--filesystem=/media",
    "--filesystem=/mnt",
    "--device=dri",
    "--talk-name=org.freedesktop.FileManager1",
    "--talk-name=org.gtk.vfs.*",
    "--env=PYTHONPATH=/app/lib/python3.12/site-packages"
  ],
  "modules": [
    {
      "name": "cmake",
      "buildsystem": "cmake-ninja",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/Kitware/CMake/releases/download/v3.28.1/cmake-3.28.1.tar.gz",
          "sha256": "15e94f83e647f7d620a140a7a5da76349fc47a1bfed66d0f5cdee8e7344079ad"
        }
      ]
    },
    {
      "name": "ninja",
      "buildsystem": "simple",
      "build-commands": [
        "python3 configure.py --bootstrap",
        "install -Dm755 ninja /app/bin/ninja"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/ninja-build/ninja/archive/v1.11.1.tar.gz",
          "sha256": "31747ae633213f1eda3842686f83c2aa1412e0f5691d1c14dbbcc67fe7400cea"
        }
      ]
    },
    {
      "name": "liboqs",
      "buildsystem": "cmake-ninja",
      "config-opts": [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DOQS_BUILD_ONLY_LIB=ON",
        "-DOQS_DIST_BUILD=ON",
        "-DOQS_USE_OPENSSL=ON"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/open-quantum-safe/liboqs/archive/refs/tags/0.12.0.tar.gz",
          "sha256": "df999915204eb1eba311d89e83d1edd3a514d5a07374745d6a9e5b2dd0d59c08"
        }
      ]
    },
    {
      "name": "x11-tools",
      "buildsystem": "simple",
      "build-commands": [
        "echo 'Installing X11 virtual framebuffer...'",
        "which Xvfb || echo 'Xvfb not available in runtime'",
        "echo 'X11 tools check complete'"
      ],
      "sources": []
    },
    {
      "name": "python3-dependencies",
      "buildsystem": "simple",
      "build-options": {
        "build-args": [
          "--share=network"
        ]
      },
      "build-commands": [
        "pip3 install --prefix=${FLATPAK_DEST} 'cryptography>=44.0.1,<45.0.0'",
        "pip3 install --prefix=${FLATPAK_DEST} 'argon2-cffi>=23.1.0,<24.0.0'",
        "pip3 install --prefix=${FLATPAK_DEST} 'PyYAML>=6.0.2,<7.0.0'",
        "pip3 install --prefix=${FLATPAK_DEST} 'whirlpool-py311>=1.0.0,<2.0.0; python_version >= \"3.11\"'",
        "pip3 install --prefix=${FLATPAK_DEST} 'blake3>=1.0.0,<2.0.0'",
        "pip3 install --prefix=${FLATPAK_DEST} git+https://github.com/open-quantum-safe/liboqs-python.git"
      ],
      "sources": []
    },
    {
      "name": "openssl-encrypt",
      "buildsystem": "simple",
      "build-commands": [
        "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} . --no-build-isolation"
      ],
      "post-install": [
        "install -Dm644 flatpak/com.opensslencrypt.OpenSSLEncrypt.desktop /app/share/applications/com.opensslencrypt.OpenSSLEncrypt.desktop",
        "install -Dm644 flatpak/com.opensslencrypt.OpenSSLEncrypt.svg /app/share/icons/hicolor/scalable/apps/com.opensslencrypt.OpenSSLEncrypt.svg",
        "install -Dm644 flatpak/com.opensslencrypt.OpenSSLEncrypt.metainfo.xml /app/share/metainfo/com.opensslencrypt.OpenSSLEncrypt.metainfo.xml",
        "install -Dm755 flatpak/openssl-encrypt /app/bin/openssl-encrypt"
      ],
      "sources": [
        {
          "type": "dir",
          "path": ".."
        }
      ]
    }
  ]
}
