{
  "app-id": "com.opensslencrypt.OpenSSLEncrypt",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "24.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "openssl-encrypt",
  "finish-args": [
    "--share=ipc",
    "--socket=x11",
    "--socket=wayland",
    "--device=dri",
    "--filesystem=host",
    "--filesystem=xdg-run/at-spi",
    "--talk-name=org.freedesktop.FileManager1",
    "--talk-name=org.gtk.vfs.*",
    "--talk-name=org.a11y.*",
    "--env=PYTHONPATH=/app/lib/python3.12/site-packages",
    "--env=GDK_BACKEND=wayland,x11"
  ],
  "modules": [
    {
      "name": "cmake",
      "buildsystem": "cmake-ninja",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/Kitware/CMake/releases/download/v3.28.1/cmake-3.28.1.tar.gz",
          "sha256": "15e94f83e647f7d620a140a7a5da76349fc47a1bfed66d0f5cdee8e7344079ad"
        }
      ]
    },
    {
      "name": "ninja",
      "buildsystem": "simple",
      "build-commands": [
        "python3 configure.py --bootstrap",
        "install -Dm755 ninja /app/bin/ninja"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/ninja-build/ninja/archive/v1.11.1.tar.gz",
          "sha256": "31747ae633213f1eda3842686f83c2aa1412e0f5691d1c14dbbcc67fe7400cea"
        }
      ]
    },
    {
      "name": "liboqs",
      "buildsystem": "cmake-ninja",
      "config-opts": [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DOQS_BUILD_ONLY_LIB=ON",
        "-DOQS_DIST_BUILD=ON",
        "-DOQS_USE_OPENSSL=ON",
        "-DCMAKE_C_FLAGS=-DOQS_HAVE_GETENTROPY"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/open-quantum-safe/liboqs/archive/refs/tags/0.12.0.tar.gz",
          "sha256": "df999915204eb1eba311d89e83d1edd3a514d5a07374745d6a9e5b2dd0d59c08"
        }
      ]
    },
    {
      "name": "x11-tools",
      "buildsystem": "simple",
      "build-commands": [
        "echo 'Installing X11 virtual framebuffer...'",
        "which Xvfb || echo 'Xvfb not available in runtime'",
        "echo 'X11 tools check complete'"
      ],
      "sources": []
    },
    {
      "name": "python3-dependencies",
      "buildsystem": "simple",
      "build-options": {
        "build-args": [
          "--share=network"
        ]
      },
      "build-commands": [
        "pip3 install --prefix=${FLATPAK_DEST} 'cffi==1.17.1'",
        "pip3 install --prefix=${FLATPAK_DEST} 'pycparser==2.22'",
        "pip3 install --prefix=${FLATPAK_DEST} 'cryptography==44.0.3'",
        "pip3 install --prefix=${FLATPAK_DEST} 'argon2-cffi==23.1.0'",
        "pip3 install --prefix=${FLATPAK_DEST} 'argon2-cffi-bindings==21.2.0'",
        "pip3 install --prefix=${FLATPAK_DEST} 'PyYAML==6.0.2'",
        "pip3 install --prefix=${FLATPAK_DEST} 'whirlpool-py311==1'",
        "pip3 install --prefix=${FLATPAK_DEST} 'blake3==1.0.5'",
        "pip3 install --prefix=${FLATPAK_DEST} 'Pillow==11.3.0'",
        "pip3 install --prefix=${FLATPAK_DEST} 'numpy==2.3.2'",
        "pip3 install --prefix=${FLATPAK_DEST} 'qrcode[pil]==8.2'",
        "pip3 install --prefix=${FLATPAK_DEST} 'pyzbar==0.1.9'",
        "pip3 install --prefix=${FLATPAK_DEST} 'RandomX==1.1.10.post3'",
        "pip3 install --prefix=${FLATPAK_DEST} 'jsonschema>=4.0.0,<5.0.0'",
        "pip3 install --prefix=${FLATPAK_DEST} 'git+https://github.com/open-quantum-safe/liboqs-python.git@0.12.0'"
      ],
      "sources": []
    },
    {
      "name": "flutter-desktop-gui",
      "buildsystem": "simple",
      "build-commands": [
        "echo 'ðŸ“¦ Installing pre-built Flutter desktop GUI...'",
        "if [ -d desktop_gui/build/linux/x64/release/bundle ]; then echo 'âœ… Found pre-built Flutter binary' && mkdir -p /app/bin/openssl-encrypt-gui && cp -r desktop_gui/build/linux/x64/release/bundle/* /app/bin/openssl-encrypt-gui/ && chmod +x /app/bin/openssl-encrypt-gui/openssl_encrypt_mobile && echo 'âœ… Flutter desktop GUI installed successfully'; else echo 'âš ï¸  No pre-built Flutter binary found' && echo 'âš ï¸  Run: cd desktop_gui && flutter build linux --release' && echo 'âš ï¸  Continuing without Flutter GUI (tkinter fallback available)'; fi"
      ],
      "sources": [
        {
          "type": "dir",
          "path": ".."
        }
      ]
    },
    {
      "name": "openssl-encrypt",
      "buildsystem": "simple",
      "build-commands": [
        "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} . --no-build-isolation"
      ],
      "post-install": [
        "install -Dm644 flatpak/com.opensslencrypt.OpenSSLEncrypt.desktop /app/share/applications/com.opensslencrypt.OpenSSLEncrypt.desktop",
        "install -Dm644 flatpak/com.opensslencrypt.OpenSSLEncrypt.svg /app/share/icons/hicolor/scalable/apps/com.opensslencrypt.OpenSSLEncrypt.svg",
        "install -Dm644 flatpak/com.opensslencrypt.OpenSSLEncrypt.metainfo.xml /app/share/metainfo/com.opensslencrypt.OpenSSLEncrypt.metainfo.xml",
        "install -Dm755 flatpak/openssl-encrypt /app/bin/openssl-encrypt"
      ],
      "sources": [
        {
          "type": "dir",
          "path": ".."
        }
      ]
    }
  ]
}
