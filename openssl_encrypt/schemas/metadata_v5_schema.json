{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://opensslencrypt.com/schemas/metadata-v5.json",
  "title": "OpenSSL Encrypt Metadata Schema Version 5",
  "description": "Schema for validating encrypted file metadata format version 5 (hierarchical with encryption_data)",
  "type": "object",
  "required": ["format_version", "derivation_config", "encryption"],
  "additionalProperties": true,
  "properties": {
    "format_version": {
      "type": "integer",
      "const": 5,
      "description": "Metadata format version (must be 5)"
    },
    "derivation_config": {
      "type": "object",
      "required": ["salt"],
      "additionalProperties": true,
      "properties": {
        "salt": {
          "type": "string",
          "maxLength": 128,
          "pattern": "^[A-Za-z0-9+/]+=*$",
          "description": "Base64-encoded salt"
        },
        "hash_config": {
          "type": "object",
          "additionalProperties": true,
          "patternProperties": {
            "^(sha512|sha384|sha256|sha224|sha3_512|sha3_384|sha3_256|sha3_224|blake2b|blake3|shake256|shake128|whirlpool)$": {
              "type": "object",
              "required": ["rounds"],
              "additionalProperties": true,
              "properties": {
                "rounds": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 1000000,
                  "description": "Number of hash rounds (0 = disabled)"
                }
              }
            }
          }
        },
        "kdf_config": {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "pbkdf2": {
              "type": "object",
              "required": ["rounds"],
              "additionalProperties": true,
              "properties": {
                "rounds": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 10000000,
                  "description": "PBKDF2 iteration count"
                }
              }
            },
            "scrypt": {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Whether scrypt is enabled"
                },
                "n": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1048576,
                  "description": "Scrypt N parameter"
                },
                "r": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 256,
                  "description": "Scrypt r parameter"
                },
                "p": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 256,
                  "description": "Scrypt p parameter"
                },
                "rounds": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 1000,
                  "description": "Scrypt rounds"
                }
              }
            },
            "argon2": {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Whether Argon2 is enabled"
                },
                "time_cost": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Argon2 time cost"
                },
                "memory_cost": {
                  "type": "integer",
                  "minimum": 1024,
                  "maximum": 4194304,
                  "description": "Argon2 memory cost in KiB"
                },
                "parallelism": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 256,
                  "description": "Argon2 parallelism"
                },
                "hash_len": {
                  "type": "integer",
                  "minimum": 16,
                  "maximum": 128,
                  "description": "Argon2 hash length"
                },
                "type": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 2,
                  "description": "Argon2 type (0=d, 1=i, 2=id)"
                },
                "rounds": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 1000,
                  "description": "Argon2 rounds"
                }
              }
            },
            "balloon": {
              "type": "object",
              "additionalProperties": true,
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Whether Balloon is enabled"
                },
                "time_cost": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 1000,
                  "description": "Balloon time cost"
                },
                "space_cost": {
                  "type": "integer",
                  "minimum": 1024,
                  "maximum": 4194304,
                  "description": "Balloon space cost"
                },
                "parallelism": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 256,
                  "description": "Balloon parallelism"
                },
                "rounds": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 1000,
                  "description": "Balloon rounds"
                }
              }
            }
          }
        },
        "pqc_public_key": {
          "type": "string",
          "maxLength": 65536,
          "pattern": "^[A-Za-z0-9+/]+=*$",
          "description": "Base64-encoded PQC public key (max 64KB)"
        },
        "pqc_private_key": {
          "type": "string",
          "maxLength": 65536,
          "pattern": "^[A-Za-z0-9+/]+=*$",
          "description": "Base64-encoded PQC private key (max 64KB)"
        },
        "dual_encryption": {
          "type": "boolean",
          "description": "Whether dual encryption mode is used"
        },
        "keystore_id": {
          "type": "string",
          "maxLength": 64,
          "pattern": "^[a-zA-Z0-9_-]+$",
          "description": "Keystore identifier"
        }
      }
    },
    "hashes": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "original_hash": {
          "type": "string",
          "maxLength": 128,
          "pattern": "^[a-fA-F0-9]*$",
          "description": "Hexadecimal hash of original file"
        },
        "encrypted_hash": {
          "type": "string",
          "maxLength": 128,
          "pattern": "^[a-fA-F0-9]*$",
          "description": "Hexadecimal hash of encrypted content"
        }
      }
    },
    "encryption": {
      "type": "object",
      "required": ["algorithm"],
      "additionalProperties": true,
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": [
            "fernet",
            "aes-gcm",
            "aes-gcm-siv",
            "aes-ocb3",
            "aes-siv",
            "chacha20-poly1305",
            "xchacha20-poly1305",
            "ml-kem-768-hybrid",
            "ml-kem-1024-hybrid",
            "kyber512-hybrid",
            "kyber768-hybrid",
            "kyber1024-hybrid"
          ],
          "description": "Encryption algorithm used"
        },
        "encryption_data": {
          "type": "string",
          "enum": [
            "aes-gcm",
            "aes-gcm-siv",
            "aes-ocb3",
            "aes-siv",
            "chacha20-poly1305",
            "xchacha20-poly1305",
            "fernet"
          ],
          "description": "Data encryption algorithm (version 5 addition)"
        }
      }
    }
  }
}
