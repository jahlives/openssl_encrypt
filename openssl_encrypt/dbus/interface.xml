<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd">
<node>
  <!--
    D-Bus Interface for openssl_encrypt Cryptographic Service

    This interface provides secure encryption, decryption, and key management
    operations via D-Bus IPC, enabling cross-language integration without
    requiring network access.

    Service: ch.rmrf.openssl_encrypt
    Object Path: /ch/rmrf/openssl_encrypt/CryptoService
    Interface: ch.rmrf.openssl_encrypt.Crypto
  -->
  <interface name="ch.rmrf.openssl_encrypt.Crypto">

    <!-- ========================================
         File Encryption Operations
         ======================================== -->

    <!--
      EncryptFile: Encrypts a file with specified algorithm and password

      Args:
        input_path (s): Absolute path to input file
        output_path (s): Absolute path to output encrypted file
        password (s): Encryption password (will be securely zeroed after use)
        algorithm (s): Encryption algorithm (e.g., "fernet", "aes-gcm", "ml-kem-768-hybrid")
        options (a{sv}): Optional parameters as variant dict, supports:
          - "sha256_rounds" (i): Number of SHA-256 rounds
          - "sha512_rounds" (i): Number of SHA-512 rounds
          - "blake3_rounds" (i): Number of BLAKE3 rounds
          - "balloon_rounds" (i): Number of Balloon hash rounds
          - "enable_hkdf" (b): Enable HKDF key derivation
          - "argon2_mode" (s): Argon2 mode ("argon2i", "argon2d", "argon2id")
          - "template" (s): Preset template ("quick", "standard", "paranoid")

      Returns:
        success (b): True if encryption succeeded
        error_msg (s): Error message (empty on success)
        operation_id (s): Unique ID for tracking progress via Progress signal
    -->
    <method name="EncryptFile">
      <arg name="input_path" type="s" direction="in"/>
      <arg name="output_path" type="s" direction="in"/>
      <arg name="password" type="s" direction="in"/>
      <arg name="algorithm" type="s" direction="in"/>
      <arg name="options" type="a{sv}" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
      <arg name="operation_id" type="s" direction="out"/>
    </method>

    <!--
      DecryptFile: Decrypts a file encrypted by openssl_encrypt

      Args:
        input_path (s): Absolute path to encrypted file
        output_path (s): Absolute path to output decrypted file
        password (s): Decryption password (will be securely zeroed after use)

      Returns:
        success (b): True if decryption succeeded
        error_msg (s): Error message (empty on success)
        operation_id (s): Unique ID for tracking progress via Progress signal
    -->
    <method name="DecryptFile">
      <arg name="input_path" type="s" direction="in"/>
      <arg name="output_path" type="s" direction="in"/>
      <arg name="password" type="s" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
      <arg name="operation_id" type="s" direction="out"/>
    </method>

    <!--
      EncryptData: Encrypts binary data directly (no file I/O)

      Args:
        data (ay): Binary data to encrypt
        password (s): Encryption password
        algorithm (s): Encryption algorithm
        options (a{sv}): Optional parameters

      Returns:
        success (b): True if encryption succeeded
        encrypted_data (ay): Encrypted binary data (empty on failure)
        error_msg (s): Error message (empty on success)
    -->
    <method name="EncryptData">
      <arg name="data" type="ay" direction="in"/>
      <arg name="password" type="s" direction="in"/>
      <arg name="algorithm" type="s" direction="in"/>
      <arg name="options" type="a{sv}" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="encrypted_data" type="ay" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
    </method>

    <!--
      DecryptData: Decrypts binary data directly (no file I/O)

      Args:
        encrypted_data (ay): Encrypted binary data
        password (s): Decryption password

      Returns:
        success (b): True if decryption succeeded
        data (ay): Decrypted binary data (empty on failure)
        error_msg (s): Error message (empty on success)
    -->
    <method name="DecryptData">
      <arg name="encrypted_data" type="ay" direction="in"/>
      <arg name="password" type="s" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="data" type="ay" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
    </method>

    <!-- ========================================
         Secure File Operations
         ======================================== -->

    <!--
      SecureShredFile: Securely deletes a file using multi-pass overwriting

      Args:
        file_path (s): Absolute path to file to shred
        passes (i): Number of overwrite passes (default: 3)

      Returns:
        success (b): True if shredding succeeded
        error_msg (s): Error message (empty on success)
    -->
    <method name="SecureShredFile">
      <arg name="file_path" type="s" direction="in"/>
      <arg name="passes" type="i" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
    </method>

    <!-- ========================================
         Post-Quantum Keystore Operations
         ======================================== -->

    <!--
      GeneratePQCKey: Generates a post-quantum cryptographic key pair

      Args:
        algorithm (s): PQC algorithm (e.g., "ml-kem-768", "kyber-1024", "hqc-256")
        keystore_path (s): Path to keystore file
        keystore_password (s): Keystore password
        key_name (s): Human-readable name for the key

      Returns:
        success (b): True if key generation succeeded
        key_id (s): Generated key ID (empty on failure)
        error_msg (s): Error message (empty on success)
    -->
    <method name="GeneratePQCKey">
      <arg name="algorithm" type="s" direction="in"/>
      <arg name="keystore_path" type="s" direction="in"/>
      <arg name="keystore_password" type="s" direction="in"/>
      <arg name="key_name" type="s" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="key_id" type="s" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
    </method>

    <!--
      ListPQCKeys: Lists all keys in a keystore

      Args:
        keystore_path (s): Path to keystore file
        keystore_password (s): Keystore password

      Returns:
        success (b): True if listing succeeded
        keys (aa{ss}): Array of key info dictionaries containing:
          - "key_id": Key identifier
          - "key_name": Human-readable name
          - "algorithm": PQC algorithm
          - "created": Creation timestamp
        error_msg (s): Error message (empty on success)
    -->
    <method name="ListPQCKeys">
      <arg name="keystore_path" type="s" direction="in"/>
      <arg name="keystore_password" type="s" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="keys" type="aa{ss}" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
    </method>

    <!--
      DeletePQCKey: Deletes a key from the keystore

      Args:
        keystore_path (s): Path to keystore file
        keystore_password (s): Keystore password
        key_id (s): Key ID to delete

      Returns:
        success (b): True if deletion succeeded
        error_msg (s): Error message (empty on success)
    -->
    <method name="DeletePQCKey">
      <arg name="keystore_path" type="s" direction="in"/>
      <arg name="keystore_password" type="s" direction="in"/>
      <arg name="key_id" type="s" direction="in"/>
      <arg name="success" type="b" direction="out"/>
      <arg name="error_msg" type="s" direction="out"/>
    </method>

    <!-- ========================================
         Information and Capability Queries
         ======================================== -->

    <!--
      GetSupportedAlgorithms: Lists all supported encryption algorithms

      Returns:
        algorithms (as): Array of algorithm names
    -->
    <method name="GetSupportedAlgorithms">
      <arg name="algorithms" type="as" direction="out"/>
    </method>

    <!--
      GetVersion: Returns the openssl_encrypt version

      Returns:
        version (s): Version string (e.g., "1.2.1")
    -->
    <method name="GetVersion">
      <arg name="version" type="s" direction="out"/>
    </method>

    <!--
      ValidatePassword: Checks if a password meets security policy

      Args:
        password (s): Password to validate

      Returns:
        valid (b): True if password meets policy
        issues (as): Array of validation issues (empty if valid)
    -->
    <method name="ValidatePassword">
      <arg name="password" type="s" direction="in"/>
      <arg name="valid" type="b" direction="out"/>
      <arg name="issues" type="as" direction="out"/>
    </method>

    <!-- ========================================
         Signals
         ======================================== -->

    <!--
      Progress: Emitted during long-running operations

      Args:
        operation_id (s): Operation identifier from Encrypt/Decrypt call
        percent (d): Progress percentage (0.0 to 100.0)
        message (s): Human-readable progress message
    -->
    <signal name="Progress">
      <arg name="operation_id" type="s"/>
      <arg name="percent" type="d"/>
      <arg name="message" type="s"/>
    </signal>

    <!--
      OperationComplete: Emitted when an operation finishes

      Args:
        operation_id (s): Operation identifier
        success (b): True if operation succeeded
        error_msg (s): Error message (empty on success)
    -->
    <signal name="OperationComplete">
      <arg name="operation_id" type="s"/>
      <arg name="success" type="b"/>
      <arg name="error_msg" type="s"/>
    </signal>

    <!-- ========================================
         Properties
         ======================================== -->

    <!--
      ActiveOperations: Number of currently running operations
    -->
    <property name="ActiveOperations" type="u" access="read"/>

    <!--
      MaxConcurrentOperations: Maximum number of concurrent operations allowed
    -->
    <property name="MaxConcurrentOperations" type="u" access="readwrite"/>

    <!--
      DefaultTimeout: Default operation timeout in seconds
    -->
    <property name="DefaultTimeout" type="u" access="readwrite"/>

  </interface>
</node>
